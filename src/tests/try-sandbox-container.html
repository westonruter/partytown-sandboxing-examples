<!--
  THIS TEST DOES NOT WORK
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf8" />
    <title>Try Sandbox Container</title>
    <script>
      var partytown = {
        debug: true,
        logCalls: true,
        logGetters: true,
        logSetters: true,
        apply: (opts) => {
          const { instance } = opts; // Note: The instance is normally not supplied. It is made available by manually hacking createHookOptions.

          console.info(opts.instance)
          const mutationMethods = new Set(['insertBefore', /*...*/]);
          if (!mutationMethods.has(opts.name)) {
            return opts.continue;
          }


          let isInsideDocument = false;
          let isInsideSandbox = false;
          if ('parentNode' in opts.instance) { // @todo This fails for the style propertie which is a CSSStyleDeclaration.
            let parent = instance;
            while (parent) {
              if (parent == instance.ownerDocument.documentElement ) {
                isInsideDocument = true;
              }
              if ( parent.id === 'sandbox' ) {
                isInsideSandbox = true;
              }
              parent = parent.parentNode;
            }
            if ( ! isInsideDocument ) {
              return opts.continue;
            }
            if ( ! isInsideSandbox )  {
              return opts.prevent;
            }
          }
          return opts.continue;
        },
      };
    </script>
    <style>
      #sandbox {
        outline: dotted 1px black;
        padding: 1em;
      }
    </style>
  </head>
  <body>
    <h1>Try Sandbox Container</h1>

    <p><strong>Note: This test will not work because <code>instance</code> is not exposed in hooks and even when it is there may not be a reference to the parent node (as in the case of <code>style</code> property) in order to determine whether it is inside the sandbox.</code>)</strong></p>

    <div id="sandbox">
      <div>
        <p class="test">This paragraph is inside the sandbox.</p>
      </div>
    </div>

    <p class="test">This paragraph is outside the sandbox.</p>

    <p>When the page load, the desire is to make sure that only the paragraphs inside of the sandbox are muted. Mutation is shown as the paragraph being given a red text color.</p>

    <script type="text/javascript">
      for ( const p of document.querySelectorAll( '.test' ) ) {
        const text = document.createTextNode( ' This text was added by the sandboxed script!' );
        p.appendChild(text);
      }
    </script>
  </body>
</html>
